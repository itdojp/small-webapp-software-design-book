<div class="sidebar-content">
  <div class="book-info">
    <h2 class="book-title">{{ site.title | escape }}</h2>
    <p class="book-subtitle">{{ site.description | escape }}</p>
  </div>

  {% assign nav = site.data.navigation %}

  <div class="toc">
    <h3 class="toc-title">目次</h3>

    <div class="toc-section">
      <ul class="toc-list">
        <li class="toc-item">
          <a href="{{ '/' | relative_url }}" class="toc-link {% if page.url == '/' %}active{% endif %}">トップ</a>
        </li>
        <li class="toc-item">
          <a href="{{ '/chapters/' | relative_url }}" class="toc-link {% if page.url == '/chapters/' %}active{% endif %}">目次</a>
        </li>
      </ul>
    </div>

    <div class="toc-section">
      <h3 class="toc-section-title">本編</h3>
      <ul class="toc-list">
        {% for item in nav.chapters %}
          {% if item.path and item.path != '/chapters/' %}
            {% assign chapter_title = item.title | default: '' %}
            {% assign chapter_number = '' %}
            {% assign chapter_label = chapter_title %}
            {% if chapter_title contains '. ' %}
              {% assign parts = chapter_title | split: '. ' %}
              {% if parts.size >= 2 %}
                {% assign chapter_number = parts[0] | strip %}
                {% assign chapter_label = parts[1] | strip %}
              {% endif %}
            {% endif %}

            <li class="toc-item toc-chapter">
              <a href="{{ item.path | relative_url }}" class="toc-link {% if page.url == item.path %}active{% endif %}">
                {% if chapter_number != '' %}
                  <span class="chapter-number">{{ chapter_number }}.</span>{{ chapter_label }}
                {% else %}
                  {{ chapter_title }}
                {% endif %}
              </a>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>

    <div class="toc-section">
      <h3 class="toc-section-title">Appendix</h3>
      <ul class="toc-list">
        {% for item in nav.appendices %}
          {% if item.path %}
            {% assign appendix_title = item.title | default: '' %}
            {% assign appendix_number = '' %}
            {% assign appendix_label = appendix_title %}

            {% if appendix_title contains 'Appendix ' %}
              {% assign after = appendix_title | remove_first: 'Appendix ' %}
              {% assign parts = after | split: ': ' %}
              {% if parts.size >= 2 %}
                {% assign appendix_number = parts[0] | strip %}
                {% assign appendix_label = parts[1] | strip %}
              {% endif %}
            {% endif %}

            <li class="toc-item toc-chapter">
              <a href="{{ item.path | relative_url }}" class="toc-link {% if page.url == item.path %}active{% endif %}">
                {% if appendix_number != '' %}
                  <span class="chapter-number">{{ appendix_number }}.</span>{{ appendix_label }}
                {% else %}
                  {{ appendix_title }}
                {% endif %}
              </a>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="toc-section">
    <h3 class="toc-section-title">リソース</h3>
    <ul class="toc-list">
      {% assign repository = site.repository %}
      {% if repository contains "github.com/" %}
        {% assign repository = repository | split: "github.com/" | last %}
      {% endif %}

      <li class="toc-item">
        <a href="https://itdojp.github.io/it-engineer-knowledge-architecture/" class="toc-link" target="_blank" rel="noopener">書籍一覧</a>
      </li>
      <li class="toc-item">
        <a href="https://github.com/{{ repository }}" class="toc-link" target="_blank" rel="noopener">GitHub</a>
      </li>
      <li class="toc-item">
        <a href="https://github.com/{{ repository }}/blob/main/LICENSE" class="toc-link" target="_blank" rel="noopener">LICENSE</a>
      </li>
      <li class="toc-item">
        <a href="https://itdo.jp" class="toc-link" target="_blank" rel="noopener">株式会社アイティードゥ</a>
      </li>
    </ul>
  </div>
</div>
