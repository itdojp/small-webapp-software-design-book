---
title: "Appendix D: 記入例（ランニング例の完成形）"
permalink: /appendix/D-samples/
show_nav: true
prev: /appendix/B-templates/
next: /appendix/E-glossary/
---

# Appendix D: 記入例（ランニング例の完成形）

Appendix B のテンプレを、ランニング例（小規模タスク管理）に対して記入した例です。読みながらテンプレを埋めるときの基準として利用してください。

## D-1. 受け入れ条件（記入例）

### 対象: 「タスク割り当て + 通知」

#### 機能要件（ユーザーストーリー）

- 管理者として、タスクを担当者に割り当てたい。担当者が確実に気づけるように通知したい。

#### スコープ

- 含む:
  - 管理者が担当者を選択して割り当てる
  - 割り当て完了が画面上で確認できる
  - 担当者に通知（メール）が送信される
- 含まない（非ゴール）:
  - 通知チャネルの多重化（Slack 等）
  - 高度な配信保証（厳密な exactly-once）

#### 受け入れ条件（Given/When/Then）

- Given: 管理者がログインしており、タスクが `todo` 状態で存在する
  - When: 管理者が担当者 `user-123` を割り当てる
  - Then:
    - タスクの `assigneeId` が `user-123` に更新される
    - 画面に「割り当て完了」が表示される
    - 担当者に「タスクが割り当てられた」旨のメールが送信される

- Given: 管理者がログインしており、対象タスクが存在しない
  - When: 管理者が割り当て操作を行う
  - Then:
    - 404 相当のエラーが表示される（仕様として決める）
    - 監査/ログに「対象なし」が記録される（必要なら）

- Given: メール送信サービスが一時的に失敗する
  - When: 管理者が割り当て操作を行う
  - Then:
    - タスクの割り当て自体は成功する（業務継続を優先）
    - 送信失敗が運用で検知できる（ログ、メトリクス、アラートのいずれか）
    - 再送の方針（手動/自動）を明文化する

## D-2. 非機能（最小合意）の例

「最小合意」は、設計とテストの判断に必要な項目だけを先に固定します。以下は例です（組織の基準に合わせて調整してください）。

- 性能:
  - 一覧表示は通常時 2 秒以内（p95 など指標を決める）
- 可用性:
  - メンテ時間帯を除き稼働（SLA/SLO を将来導入する前提なら「未定」でもよい）
- セキュリティ/権限:
  - 役割（管理者/一般）と「操作可能範囲（割り当ては管理者のみ）」を固定
- 監査/ログ:
  - 割り当て（誰が/いつ/誰に）をログに残す
- 運用:
  - 通知失敗が検知できる（ログ検索 or アラート）

## D-3. S/D/V 採点（トップ依存の例）

例として、依存関係トップ 10 のうち代表的なものを記入します。

```md
| # | 依存元 | 依存先 | 依存の内容 | S | D | V | コメント（観測/根拠） | 手当案 |
|---:|---|---|---|---:|---:|---:|---|---|
| 1 | UI | API | 期限表示の算出ロジック | 3 | 3 | 4 | UI/API で別実装だと同時変更が発生 | domain に集約し両者で共有 |
| 2 | usecase | mailer | 割り当て通知の送信 | 2 | 4 | 3 | 外部I/Fで失敗が起きる、運用要件が増えやすい | adapter 化 + 失敗時の扱いを合意 |
| 3 | usecase | authz | 権限判定（管理者のみ割り当て可） | 4 | 3 | 3 | 認可ルール変更が UI/API に波及しやすい | 判定を domain 側へ寄せる |
| 4 | usecase | db | タスク更新の永続化 | 4 | 3 | 2 | 同時変更は必須、ただし変動性は低め | schema/DAO を境界に固定 |
```

採点の狙い:

- 「今すぐ手当すべき」ものは、S と D と V が同時に悪い領域になりやすい
- ただし S が強い領域は「分離」より「一体で扱う」ほうがコストが低い場合がある（章 03 の判断原則）

## D-4. テスト配分（分類例）

### 方針（ねらい）

- 価値導線: 「作成→割り当て→完了」の一連が止まると業務が停止する
- 主要リスク: 期限判定の誤り、権限漏れ、通知失敗の検知漏れ
- 許容できない障害: 権限逸脱、データ不整合（割り当てが失われる）

### 分類（例）

| 対象 | 単体 | 統合 | E2E | 補足 |
| --- | --- | --- | --- | --- |
| 期限判定 | ○ | - | △ | 画面表示は E2E で 1 本程度 |
| 状態遷移 | ○ | - | - | domain を厚く守る |
| 権限判定 | ○ | ○ | △ | 主要導線で E2E も可 |
| DB 永続化 | - | ○ | △ | schema/クエリの契約を守る |
| 通知（メール） | - | ○ | - | 外部I/Fは統合で stub 化 |
| 主要導線 | - | △ | ○ | E2E は少数精鋭 |

配分の目安（例）:

- 単体 20 / 統合 10 / E2E 3

## D-5. ADR（記入例）

```md
# ADR: 通知（メール）失敗時の扱いを「業務継続優先」にする

- Status: accepted
- Date: 2026-01-12
- Deciders: 開発チーム
- Scope: タスク割り当て/通知

## Context

- 背景: 割り当て時に通知（メール）が必要になった
- 問題: メール送信は外部I/Fであり、失敗/遅延が発生する
- 制約: 割り当ては業務上の確定であり、通知失敗で割り当て自体を失敗させたくない

## Decision

- 採用する決定: 割り当ての永続化は成功させ、通知失敗は「検知 + 再送方針」で扱う
- 理由: D が大きい外部I/Fである一方、割り当ての S は強い（同時変更が必須）。境界（adapter）で失敗を吸収し、ユースケースは業務確定を優先する

## Consequences

- 得られる効果: 業務フローが外部障害に引きずられにくい
- トレードオフ: 「通知が届いていない」可能性が残るため、運用で検知する必要がある
- 後続タスク: 失敗ログ/メトリクス整備、再送手順の明文化
- 見直し条件: 通知がSLA対象になった、または失敗が頻発した場合
```

## D-6. Change Drivers（記入例）

```md
# Change Drivers: 通知を境界として強める

## 背景（何が起きているか）

- 事象（観測）: 通知失敗が顕在化し、問い合わせが発生した
- 影響: 担当者が気づかず、期限超過が増える
- 期限: 次のリリースまでに検知手段を用意したい

## ドライバー（何が変更を必要にしているか）

| ドライバー | 内容 | 強さ（低/中/高） | 根拠 |
|---|---|---|---|
| 変動性（V） | 通知要件が増える | 中 | 追加要望（再送/テンプレ）が出ている |
| 距離（D） | 外部メールI/F | 高 | 失敗/遅延が発生する |
| 統合強度（S） | 割り当て確定は必須 | 高 | 業務確定のため |
| 運用要件 | 失敗検知が必要 | 高 | 問い合わせが発生した |
| チーム/組織 | 単一チーム | 低 | 現時点では分割不要 |

## 対応方針（案）

- 何を変える: 通知を adapter として明確化し、失敗を検知できる形にする
- 変えないこと（非ゴール）: 高度な配信保証、複数チャネル対応
- テスト戦略への影響: 通知は統合テスト中心、E2E には入れない
- ADR が必要か: 必要（通知の扱いは重大な分岐）
```

## 前後リンク

- [目次]({{ '/chapters/' | relative_url }})
- [前: Appendix B（テンプレ集）]({{ '/appendix/B-templates/' | relative_url }})
- [次: Appendix E（用語集）]({{ '/appendix/E-glossary/' | relative_url }})
