---
title: "07. 進化条件（ADRと境界の強化タイミング）"
permalink: /chapters/07-evolution-and-adr/
show_nav: true
prev: /chapters/06-test-strategy-pyramid/
next: /appendix/A-checklists/
---

# 07. 進化条件（ADRと境界の強化タイミング）

## 目的

- 「いつ境界を強めるか」を、観測可能な条件（S/D/V の悪化、運用要件）で判断できるようにする
- ADR を最小限に運用し、意思決定の再現性と合意形成の速度を上げる

## 得られる判断能力

- 「最初から大掛かりにしない」ための進化条件（トリガー）を定義できる
- 進化の根拠を S/D/V と運用要件で説明できる（気分で境界を増やさない）
- ADR を最小運用し、意思決定を再利用できる形で残せる

## 前提/用語

- **ADR**: Architecture Decision Record（意思決定の記録）
- **進化条件**: 現状の設計が限界に近づいた兆候（変更の痛み、障害、運用負債）

## 要点

- 境界の強化は、コストに見合うトリガーが発生したときに行う（先回りしない）
- S/D/V の悪化は「結合の偏り」の兆候。トップ依存の再採点で把握する
- ADR は長文ではなく、**Context / Decision / Consequences** の最小記録でよい

## 例（ランニング例）

タスク管理の進化条件を例にします。

- 通知要件が増え、メール送信が失敗するケースが顕在化した
  - 失敗時の扱い（リトライ、監視、手動復旧）が要件化される
  - D（距離）が大きい外部I/Fのため、境界（adapter）の責務が増える
  - 判断: ユースケースから直接送らず、「通知要求の発行」と「送信処理」を分離する価値が出る

- 権限モデルが拡張され、UI と API の条件分岐が急増した
  - V（変動性）が上がり、知識の共有が拡散している兆候
  - 判断: 権限判定を domain 側へ寄せ、UI/API は同一の判定結果を利用する

### ADR の最小運用（例）

- ADR は「重大な分岐」だけに絞る（例: 通知方式、権限モデル、データ整合性の戦略）
- 1 ADR は 1 決定。議事録化しない
- 見直し条件（いつ再評価するか）を必ず書く

## 演習（最小1個）

ランニング例で ADR を 1 本作成してください（Appendix B のテンプレ利用）。

- [Appendix B: テンプレ集]({{ '/appendix/B-templates/' | relative_url }})

例（題材）:

- 状況: 通知（メール）の失敗が業務影響を持ち始めた
- 選択肢: 直接送信 / 通知要求の発行 + 非同期送信 / リトライキュー導入 など
- 目的: 失敗時の取り扱いを明確にし、テスト容易性と運用性を確保する

## よくある失敗

- ADR が議事録化し、意思決定の要点が埋もれる
- 進化の根拠が「気分」になり、境界強化が目的化する
- 変更の痛みを可視化しないまま、部分最適なリファクタリングを繰り返す

## チェックリスト

- [ ] 境界強化のトリガーが明確（S/D/V、運用要件、変更頻度）
- [ ] ADR の粒度が一定で、検索・再利用できる
- [ ] 設計変更がテスト戦略（配分）に反映されている

## 前後リンク

- [目次]({{ '/chapters/' | relative_url }})
- [前章: 06. テスト戦略（単体/統合/E2E）]({{ '/chapters/06-test-strategy-pyramid/' | relative_url }})
- [次: Appendix A]({{ '/appendix/A-checklists/' | relative_url }})
