---
title: "05. 設計時にテストを織り込む"
permalink: /chapters/05-design-for-testability/
show_nav: true
prev: /chapters/04-minimal-architecture-ts/
next: /chapters/06-test-strategy-pyramid/
---

# 05. 設計時にテストを織り込む

## 目的

- テスト容易性を「後付け作業」にしないための設計原則を押さえる
- 観察可能な振る舞い・境界・依存の扱いを整理し、保守性を上げる

## 前提/用語

- **観察可能性**: 期待する結果が、テストで確実に検証できる性質
- **CQS**: Command-Query Separation（状態変更と参照の分離）
- **スタブ/モック**: 外部依存を代替し、制御可能にする手段

## 要点

- テストは「内部実装」より「振る舞い（契約）」を守る
- 副作用境界を明確にし、コアは単体テストで守れる形にする
- モックが増える設計は、境界の置き方が不適切なシグナルになり得る

## 演習（最小1個）

次のような関数を、テストしやすい形に分割してください。

- 入力: フォーム入力
- 処理: バリデーション + 価格計算 + API 呼び出し
- 出力: 画面表示（成功/失敗）

期待する成果:

- 純粋関数に分離できる箇所を特定できる
- I/O の境界を言語化できる

## よくある失敗

- テストのために抽象化を増やし、設計が複雑化する
- モックの状態がテストの本質になり、変更に弱くなる
- 例外系の振る舞い（エラー表示、リトライ、ログ）が曖昧なまま実装する

## チェックリスト

- [ ] 単体テスト対象（コア）と統合テスト対象（境界）が分けられている
- [ ] 例外系の振る舞いが要件・受け入れ条件と整合している
- [ ] モック/スタブの利用理由が説明できる（依存の制御）

## 前後リンク

- [目次]({{ '/chapters/' | relative_url }})
- [前章: 04. 小規模TS向けの最小アーキテクチャ]({{ '/chapters/04-minimal-architecture-ts/' | relative_url }})
- [次章: 06. テスト戦略（単体/統合/E2E）]({{ '/chapters/06-test-strategy-pyramid/' | relative_url }})
